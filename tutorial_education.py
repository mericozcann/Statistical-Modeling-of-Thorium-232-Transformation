# -*- coding: utf-8 -*-
"""tutorial_education.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1UVsxfFV41MWIUkSpDRu9IuFYFWyOT1kR
"""

# ============================================================
# Toryum 232 DÃ¶nÃ¼ÅŸÃ¼mÃ¼nÃ¼n Ä°statistiksel Modellemesi
# EÄŸitim AmaÃ§lÄ± Veri Bilimi Projesi
# ============================================================
# YÃ¼rÃ¼tÃ¼cÃ¼ AdayÄ±: Yusuf Erim YaÅŸar
# Proje Fikir Sahibi ve GÃ¶nÃ¼llÃ¼sÃ¼: MeriÃ§ Ã–zcan
# ------------------------------------------------------------
# AmaÃ§:
# Toryum-232 â†’ Protaktinyum-233 â†’ Uranyum-233 dÃ¶nÃ¼ÅŸÃ¼m zincirini
# sadece sentetik veriler ve istatistiksel modelleme teknikleriyle
# temsil eden bir eÄŸitim simÃ¼lasyonu oluÅŸturmaktÄ±r.
# GerÃ§ek nÃ¼kleer deney, Ã¼retim veya iÅŸlem iÃ§ermez.
# ============================================================

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import warnings

warnings.filterwarnings("ignore")

# ============================================================
# 1. SENTETÄ°K VERÄ° OLUÅTURMA
# ============================================================

def create_synthetic_data():
    np.random.seed(42)
    t = np.arange(0, 200)
    true_signal = np.linspace(100, 700, 200)
    background = np.full(200, 7)
    counts = np.random.poisson(lam=true_signal + background)

    df = pd.DataFrame({
        "t": t,
        "counts": counts,
        "true_signal": true_signal,
        "background": background
    })
    df.to_csv("synthetic_counts.csv", index=False)
    print("âœ… Sentetik veri oluÅŸturuldu: synthetic_counts.csv")
    return df

# ============================================================
# 2. VERÄ°YÄ° YÃœKLE VE TEMEL ANALÄ°Z
# ============================================================

def load_and_describe():
    df = pd.read_csv("synthetic_counts.csv")
    print("ğŸ”¹ Veri boyutu:", df.shape)
    print(df.head())
    print("\nğŸ“Š Temel Ä°statistikler:\n", df.describe())
    return df

# ============================================================
# 3. GÃ–RSELLEÅTÄ°RME
# ============================================================

def visualize_data(df):
    plt.figure(figsize=(10, 5))
    plt.plot(df["t"], df["counts"], label="GÃ¶zlemlenen SayÄ±mlar", color="blue")
    plt.plot(df["t"], df["true_signal"], label="GerÃ§ek Sinyal (model)", color="orange", linestyle="--")
    plt.title("Sentetik SayÄ±m Zaman Serisi")
    plt.xlabel("Zaman (t)")
    plt.ylabel("Counts")
    plt.legend()
    plt.tight_layout()
    plt.savefig("plot_timeseries.png", dpi=300)
    plt.show()
    print("ğŸ’¾ GÃ¶rsel kaydedildi: plot_timeseries.png")

# ============================================================
# 4. POISSON REGRESYON (EÄÄ°TÄ°M AMAÃ‡LI)
# ============================================================

def poisson_glm(df):
    try:
        import statsmodels.api as sm
        import statsmodels.formula.api as smf
        model = smf.glm(formula="counts ~ true_signal", data=df, family=sm.families.Poisson()).fit()
        print(model.summary())
        print("âœ… Poisson GLM baÅŸarÄ±yla Ã§alÄ±ÅŸtÄ±.")
    except Exception as e:
        print("âš ï¸ Poisson GLM Ã§alÄ±ÅŸtÄ±rÄ±lamadÄ±:", e)
        print("Statsmodels paketini kurmak iÃ§in: pip install statsmodels")

# ============================================================
# 5. BOOTSTRAP ANALÄ°ZÄ°
# ============================================================

def bootstrap_analysis(df, n_boot=1000):
    rng = np.random.default_rng(123)
    medians = [np.median(rng.choice(df["counts"], size=len(df), replace=True)) for _ in range(n_boot)]

    plt.figure(figsize=(8, 4))
    sns.histplot(medians, bins=30, kde=True)
    plt.title("Bootstrap: Counts Medyan DaÄŸÄ±lÄ±mÄ±")
    plt.xlabel("Medyan DeÄŸer")
    plt.tight_layout()
    plt.savefig("plot_bootstrap.png", dpi=300)
    plt.show()
    print("ğŸ’¾ GÃ¶rsel kaydedildi: plot_bootstrap.png")

# ============================================================
# 6. ANOMALÄ° TESPÄ°TÄ° (ISOLATION FOREST)
# ============================================================

def anomaly_detection(df):
    try:
        from sklearn.ensemble import IsolationForest
        model = IsolationForest(contamination=0.03, random_state=42)
        df["anomaly"] = model.fit_predict(df[["counts"]])
        df["anomaly"] = df["anomaly"].apply(lambda x: 1 if x == -1 else 0)

        plt.figure(figsize=(10, 5))
        plt.plot(df["t"], df["counts"], label="SayÄ±m", color="gray")
        anomalies = df[df["anomaly"] == 1]
        plt.scatter(anomalies["t"], anomalies["counts"], color="red", label="Anomali", zorder=5)
        plt.title("Anomali Tespiti (Isolation Forest)")
        plt.xlabel("Zaman (t)")
        plt.ylabel("Counts")
        plt.legend()
        plt.tight_layout()
        plt.savefig("plot_anomalies.png", dpi=300)
        plt.show()
        print("ğŸ’¾ GÃ¶rsel kaydedildi: plot_anomalies.png")
        print("ğŸ”¸ Bulunan anomali sayÄ±sÄ±:", df['anomaly'].sum())
    except Exception as e:
        print("âš ï¸ Anomali tespiti baÅŸarÄ±sÄ±z:", e)
        print("Scikit-learn yÃ¼klemek iÃ§in: pip install scikit-learn")

# ============================================================
# 7. ANA Ã‡ALIÅMA AKIÅI
# ============================================================

def main():
    print("ğŸ”¬ Toryum 232 DÃ¶nÃ¼ÅŸÃ¼mÃ¼nÃ¼n Ä°statistiksel Modellemesi - EÄŸitim Projesi")
    df = create_synthetic_data()
    df = load_and_describe()
    visualize_data(df)
    poisson_glm(df)
    bootstrap_analysis(df)
    anomaly_detection(df)
    print("\nğŸ¯ EÄŸitim tamamlandÄ±. TÃ¼m Ã§Ä±ktÄ±lar kaydedildi.\n")

if __name__ == "__main__":
    main()